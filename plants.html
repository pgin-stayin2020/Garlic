
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Nicer Garlic</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="main.css"> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" 
              crossorigin="anonymous"> 
        <link rel="stylesheet" href= 
    "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            integrity= 
    "sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
            crossorigin="anonymous" 
            referrerpolicy="no-referrer" /> 

    </head>
    <body>
        <div class="container-fluid p-0 d-flex h-100"> 
            <div id="bdSidebar" 
                 class="d-flex flex-column  
                        flex-shrink-0  
                        p-3  
                        text-white offcanvas-md offcanvas-start"> 
                <a href="#" 
                   class="navbar-brand"> 
                </a><hr> 
                <ul class="mynav nav nav-pills flex-column mb-auto"> 
                    <img height="100px" width="100px" src="logo.png" align="right"></i>
                    <li class="nav-item mb-1"> 
                        <a href="#"> 
                            <i class="fa fa-home"></i> 
                            Dashboard 
                        </a> 
                    </li> 
      
                    <li class="nav-item mb-1"> 
                        <a href="#"> 
                            <i class="fa fa-user-secret"></i> 
                            Smart AI 
                            <span class="notification-badge"></span> 
                        </a> 
                    </li> 
                    <li class="nav-item mb-1"> 
                        <a href="#"> 
                            <i class="fa fa-user-circle"></i> 
                            Sub Admin 
                        </a> 
                    </li> 
                    <li class="nav-item mb-1"> 
                        <a href="#"> 
                            <i class="fa fa-user-circle"></i> 
                            Farmers 
                        </a> 
                    </li> 
             
      
                    <li class="sidebar-item  nav-item mb-1"> 
                        <a href="#" 
                           class="sidebar-link collapsed" 
                           data-bs-toggle="collapse"
                           data-bs-target="#settings"
                           aria-expanded="false"
                           aria-controls="settings"> 
                            <i class="fas fa-cog pe-2"></i> 
                            <span class="topic">Settings </span> 
                        </a> 
                        <ul id="settings" 
                            class="sidebar-dropdown list-unstyled collapse" 
                            data-bs-parent="#sidebar">                            
                            <li class="sidebar-item"> 
                                <a href="login.html" class="sidebar-link"> 
                                    <i class="fas fa-sign-out-alt pe-2"></i> 
                                    <span class="topic">Log Out</span> 
                                </a> 
                            </li> 
                        </ul> 
                    </li> 
                </ul> 
                <hr> 
      </div> 
        <div class="container" style="height: 100%;">            
        <div  style="background-color: #F1FFF2;">           
                <br> <br>
                <div class="row" align="center">
                <h2 id="titlesx">Rounded Corners</h2>
                </div>
                <br>                
                <div class="container">
                    <div class="row">
                      <div class="col-sm-6">
                        <img id="imgss" src="cinqueterre.jpg" class="img-rounded" alt="Cinque Terre" width="304" height="236"> 
                      </div>
                      <div class="col-sm-6">
                        <p id="names">NAME : </p>
                        <p id="loc">LOCATION : </p>
                        <p id="areas">AREA : </p>
                        <p id="titles">TITLE : </p>
                        <p id="varie">VARIETY : </p>
                        <p id="stat">STATUS : </p>
                      </div>
                    </div>
                  </div>
                <br>
                <div class="container">
                    <div class="row">
                      <div class="col-sm-3">
                        <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal">
                            Edit
                        </button>               

                      </div>
                      <div class="col-sm-3">
                        <button type="button" class="btn btn-warning" id="dels">
                            Delete
                        </button>        
                      </div>
                      <div class="col-sm-3">
                        <button type="button" class="btn btn-danger" id="baks">
                            Back
                        </button>        
                      </div>
                    </div>
                  </div>
                <div class="row">                    
                    <div class="col-lg-3">
                                                                <!-- Button trigger modal --
                                <!-- Modal -->
                                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">PLANT UPLOADER</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                                <form action="" id="contactForm">
                                                    <div class="inputBox">
                                                        <div class="input-group mb-3">
                                                            <span class="input-group-text" id="basic-addon3">Plant Name</span>
                                                            <input type="text" class="form-control" id="name" aria-describedby="basic-addon3">
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <div class="inputBox">
                                                                <div class="input-group mb-3">
                                                                    <span class="input-group-text" id="basic-addon3">Plant Area</span>
                                                                    <input type="text" class="form-control" id="area" aria-describedby="basic-addon3">
                                                                </div>
                                                           </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="inputBox">
                                                                <div class="input-group mb-3">
                                                                    <span class="input-group-text" id="basic-addon3">Plant Location</span>
                                                                    <input type="text" class="form-control" id="address" aria-describedby="basic-addon3">
                                                                </div>
                                                           </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <div class="inputBox">
                                                                <div class="input-group mb-3">
                                                                    <span class="input-group-text" id="basic-addon3">Plant Status</span>
                                                                    <input type="text" class="form-control" id="status" aria-describedby="basic-addon3">
                                                                </div>
                                                           </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="inputBox">
                                                                <div class="input-group mb-3">
                                                                    <span class="input-group-text" id="basic-addon3">Plant Variety</span>
                                                                    <input type="text" class="form-control" id="variety" aria-describedby="basic-addon3">
                                                                </div>
                                                           </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <div class="inputBox">
                                                                <div class="input-group mb-3">
                                                                    <span class="input-group-text" id="basic-addon3">Plant Title</span>
                                                                    <input type="text" class="form-control" id="title" aria-describedby="basic-addon3">
                                                                </div>
                                                           </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="inputBox">
                                                                <div class="input-group mb-3">
                                                                    <span class="input-group-text" id="basic-addon3">Plant Image</span>
                                                                    <input class="form-control" type="file" id="image"  />
                                                                </div>
                                                           </div>
                                                        </div>
                                                    </div>
                                                  
                                                    <input type="hidden" id="mid" name="mid" value="">         
                                        </div>
                                        <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <div class="inputBox">
                                            <button type="submit" class="btn btn-outline-success" id="subs">Submit</button>
                                        </div>
                                        </form>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                        </div>
                        
                    </div>
                   
            </div>
            <div class="col-lg-9" id="bod">
                        <div id="myDiv"></div>
                </div>

        </div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/7.14.1-0/firebase.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/7.14.1-0/firebase-auth.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/7.14.1-0/firebase-storage.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="credentials.js"></script>

    <!-- Bootstrap JS -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getStorage,uploadBytes,ref,uploadBytesResumable,getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-storage.js";    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        firebase.initializeApp(firebaseConfig);       
        var database = firebase.database();
        var para = new URLSearchParams(window.location.search);
        var area =  document.getElementById("area");
        var address =  document.getElementById("address");
        var status =  document.getElementById("status");
        var variety =  document.getElementById("variety");
        var title =  document.getElementById("title");
        var imgt="";
        var id = para.get("USER");       
        var pid = para.get("KEY");   
        var tits = document.getElementById("titlesx").innerHTML=pid; 
        var x = firebase.database().ref('users/' + id +'/plants/'+pid);
        x.on('value',function(snapshot){
            var data = snapshot.val();   
            var image = document.getElementById("imgss").src=data.image;
            imgt=image;
            document.getElementById("names").innerHTML="NAME: "+data.name;
            document.getElementById("loc").innerHTML="LOCATION: "+data.address;
            address.value=data.address;
            document.getElementById("areas").innerHTML="AREA: "+data.area;
            area.value=data.area;
            document.getElementById("titles").innerHTML="TITLE: "+data.title;
            title.value=data.title;
            document.getElementById("varie").innerHTML="VARIETY: "+data.variety;
            variety.value=data.variety;
            document.getElementById("stat").innerHTML="STATUS: "+data.status;
            status.value=data.status;
            console.log(data);
        });
        console.log(x);
        const box = document.getElementById('dels');
        const box1 = document.getElementById('baks');
        const box2 = document.getElementById('contactForm').addEventListener("submit", submitForm);;
        box1.addEventListener('click', () => {
                var para = new URLSearchParams();
                para.append("KEY", id);
                location.href = "dashboard.html?" + para.toString();            
        });
        box.addEventListener('click', () => {
            let text = "Do you want to delete?";
            if (confirm(text) == true) {
                x.remove();
                var para = new URLSearchParams();
                para.append("KEY", id);
                location.href = "dashboard.html?" + para.toString();
            } else {
                console.log("Cancel");
            }
        });
        function submitForm(e) {
            e.preventDefault();  
            var image =document.getElementById("image").value; 
            var url="";
            area = getElementVal("area");
            address = getElementVal("address");
            status = getElementVal("status");
            variety = getElementVal("variety");
            title = getElementVal("title");
            if(image!=""){
                var image =document.getElementById("image").files[0].name;            
                const fileInput = document.getElementById("image");
                const file = fileInput.files[0]; // Get the selected file
                var x = document.createElement("IMG");
                x.setAttribute("src","C:\\Uploads\\"+image);
                x.setAttribute("width", "304");
                x.setAttribute("height", "228");
                x.setAttribute("alt", name);
                x.setAttribute("id", "myImage");
                var storage = getStorage();           
                var imgx="gs://nicer-garlic-app.appspot.com/garlicImageData/"+name+".jpeg";
                const imageRef = ref(storage, "garlicImageData/"+name+".jpeg");
                uploadBytes(imageRef, file).then((snapshot) => {                
                var pp = firebase.storage().ref(imageRef._location.path_).getDownloadURL() .then((url) => {
                            document.getElementById('mid').value = url;
                            var temp= document.getElementById('mid').value;
                            console.log(temp);                          
                            myFunction(area, address,status,variety,title,url);
                            getAll();
                        })
                        .catch((error) => {
                            console.error('Error getting download URL:', error);
                        });
              });
            }        
            myFunction1(area, address,status,variety,title);          
            window.location.reload();
        }
        function myFunction(area, address, status, variety, title, image) {           
           var starCountRef1 = firebase.database().ref('users/' + id +'/plants/'+pid);
             starCountRef1.on('value', (snapshot) => {
                                 const data = snapshot.val();                               
                                     firebase.database().ref('users/'+id+'/plants/'+pid).update({
                                         name: pid,
                                         area: area,
                                         address: address,
                                         status: status,
                                         variety: variety,
                                         title: title,
                                         image: image,                                      
                                  });
                                  console.log("Image uploaded successfully!");  
                                  document.getElementById("contactForm").reset();
                                 
             });
         }
         function myFunction1(area, address, status, variety, title) {           
           var starCountRef1 = firebase.database().ref('users/' + id +'/plants/'+pid);
             starCountRef1.on('value', (snapshot) => {
                                 const data = snapshot.val();                               
                                     firebase.database().ref('users/'+id+'/plants/'+pid).update({
                                         name: pid,
                                         area: area,
                                         address: address,
                                         status: status,
                                         variety: variety,
                                         title: title,     
                                         image: imgt,                             
                                  });
                                  console.log("Image uploaded successfully!");  
                                  document.getElementById("contactForm").reset();
                                 
             });
         }
        const getElementVal = (id) => {
            return document.getElementById(id).value;
        };
      </script>
</body>
</html>